# Deployment Guide

This guide explains how to deploy your Home Maintenance Tracker app with Render (backend) and Netlify (frontend).

## Backend Deployment (Render)

### 1. Prepare Your Repository
- Ensure your code is pushed to GitHub
- The `render.yaml` file is already configured for automatic deployment

### 2. Deploy to Render
1. Go to [render.com](https://render.com) and sign up/login
2. Click "New" → "Blueprint"
3. Connect your GitHub repository
4. Render will automatically detect the `render.yaml` configuration
5. Set the following environment variables in Render:
   - `SUPABASE_URL`: Your Supabase project URL
   - `SUPABASE_ANON_KEY`: Your Supabase anonymous key
   - `FLASK_SECRET_KEY`: Will be auto-generated by Render
   - `FLASK_ENV`: Set to "production"

### 3. Get Your Backend URL
After deployment, Render will provide a URL like: `https://your-app-name.onrender.com`

## Frontend Deployment (Netlify)

### 1. Update API Configuration
1. Open `frontend/js/app.js`
2. Update the `API_BASE_URL` constant with your Render backend URL:
   ```javascript
   const API_BASE_URL = 'https://your-render-app.onrender.com';
   ```

### 2. Deploy to Netlify
1. Go to [netlify.com](https://netlify.com) and sign up/login
2. Drag and drop the `frontend/` folder to Netlify's deploy area
3. Or connect your GitHub repository and set:
   - Build command: `echo 'No build required'`
   - Publish directory: `frontend`

### 3. Custom Domain (Optional)
- You can configure a custom domain in Netlify's domain settings

## Environment Variables Required

### Render (Backend)
- `SUPABASE_URL`: Your Supabase project URL
- `SUPABASE_ANON_KEY`: Your Supabase anonymous/public key
- `FLASK_SECRET_KEY`: Auto-generated or set your own
- `FLASK_ENV`: Set to "production"

### Netlify (Frontend)
No environment variables needed - the API URL is configured in the JavaScript code.

## Database Setup (Supabase)

Make sure your Supabase database has these tables:

### users table
```sql
CREATE TABLE users (
  id SERIAL PRIMARY KEY,
  username VARCHAR(50) UNIQUE NOT NULL,
  email VARCHAR(100) UNIQUE NOT NULL,
  password_hash TEXT NOT NULL,
  created_at TIMESTAMP DEFAULT NOW()
);
```

### home_features table
```sql
CREATE TABLE home_features (
  id SERIAL PRIMARY KEY,
  user_id INTEGER REFERENCES users(id),
  has_hvac BOOLEAN DEFAULT FALSE,
  has_gutters BOOLEAN DEFAULT FALSE,
  has_dishwasher BOOLEAN DEFAULT FALSE,
  has_smoke_detectors BOOLEAN DEFAULT FALSE,
  has_water_heater BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMP DEFAULT NOW()
);
```

### tasks table
```sql
CREATE TABLE tasks (
  id SERIAL PRIMARY KEY,
  user_id INTEGER REFERENCES users(id),
  title VARCHAR(200) NOT NULL,
  description TEXT,
  frequency_days INTEGER NOT NULL,
  next_due_date DATE NOT NULL,
  is_completed BOOLEAN DEFAULT FALSE,
  last_completed DATE,
  created_at TIMESTAMP DEFAULT NOW()
);
```

## Testing the Deployment

1. Visit your Netlify frontend URL
2. Register a new account
3. Complete the home features questionnaire
4. Verify tasks are generated and displayed
5. Test completing and resetting tasks

## Troubleshooting

### Common Issues:
1. **CORS errors**: Make sure `flask-cors` is installed and configured
2. **API connection fails**: Verify the `API_BASE_URL` in the frontend matches your Render URL
3. **Database errors**: Check Supabase credentials and table structure
4. **Authentication issues**: Ensure JWT secret key is consistent

### Logs:
- **Render**: Check logs in the Render dashboard
- **Netlify**: Check function logs and deploy logs in Netlify dashboard
- **Supabase**: Monitor database queries in Supabase dashboard

## Architecture Overview

```
Frontend (Netlify) → API calls → Backend (Render) → Supabase Database
```

- **Frontend**: Static HTML/CSS/JS hosted on Netlify
- **Backend**: Flask API with JWT authentication on Render
- **Database**: PostgreSQL on Supabase
- **Authentication**: JWT tokens for stateless auth
